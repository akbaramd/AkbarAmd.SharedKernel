# GitLab CI/CD - Runs PowerShell script only
# GitLab CI/CD variable (set in GitLab UI: Settings → CI/CD → Variables)
# Variable name in GitLab: NugetKey
# Environment variable name: NUGETKEY

publish-nuget:
  image: mcr.microsoft.com/dotnet/sdk:8.0
  before_script:
    # Install PowerShell Core for Linux
    - apt-get update && apt-get install -y wget apt-transport-https software-properties-common
    - wget -q https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb
    - dpkg -i packages-microsoft-prod.deb
    - apt-get update && apt-get install -y powershell
  script:
    - pwsh -File ./Publish-Packages.ps1 -PublishToNuGet -SkipConfirmation
  artifacts:
    paths:
      - nupkgs/*.nupkg
      - nupkgs/*.snupkg
    expire_in: 30 days
  only:
    - main
    - master
    - tags
  # Change to 'on_success' if you want automatic publishing (currently manual for safety)
  when: manual

